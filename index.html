<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="그릿 테스트를 통해 당신의 인내력을 확인해보세요.">
    <meta name="keywords" content="그릿 테스트, 인내력 테스트, 그릿 점수">
    <meta name="author" content="Your Name">
    <title>그릿 테스트</title>
    <style>
        /* 간단한 CSS 스타일 */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .question {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 20px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        /* 커스텀 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>그릿 테스트</h1>
    <form id="grit-test-form">
        <!-- 질문들이 여기에 동적으로 생성됩니다. -->
    </form>
    <button onclick="calculateGritScore()">제출</button>
    <!-- 커스텀 모달 -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span id="close">&times;</span>
            <p id="modal-text"></p>
            <button id="share-button" style="display: none;" onclick="copyToClipboard()">공유하기</button>
        </div>
    </div>
    <script>
        var questions = [
            '새로운 아이디어와 프로젝트가 때때로 이전의 것들로부터 나를 방해합니다.',
            '난 좌절하지 않습니다. 쉽게 포기하지 않습니다.',
            '나는 종종 목표를 설정하지만 나중에 다른 것을 추구하기로 선택합니다.',
            '나는 열심히 일하는 사람입니다.',
            '몇 달 이상 걸리는 프로젝트에 집중하는 데 어려움을 겪습니다.',
            '나는 시작한 것을 끝까지 해냅니다.',
            '나의 관심사는 매년 바뀝니다.',
            '나는 꾸준합니다. 절대로 포기하지 않습니다.',
            '나는 짧은 시간 동안 특정 아이디어나 프로젝트에 집착했지만 나중에 관심을 잃었습니다.',
            '나는 중요한 도전을 정복하기 위해 좌절을 극복했습니다.'
        ];

        var form = document.getElementById('grit-test-form');

        questions.forEach(function(question, index) {
            var div = document.createElement('div');
            div.className = 'question';
            div.innerHTML = `
            <h2>질문 ${index + 1}</h2>
                <p>${question}</p>
                <input type="range" min="1" max="5" value="3" name="question${index + 1}">
            `;
            form.appendChild(div);
        });

        function calculateGritScore() {
            var totalScore = 0;
            for (var i = 0; i < questions.length; i++) {
                var scoreElement = document.querySelector(`input[name="question${i + 1}"]`);
                if (!scoreElement) {
                    alert('모든 질문에 답해주세요.');
                    return;
                }
                var score = scoreElement.value;
                if (isNaN(score)) {
                    alert('점수는 숫자여야 합니다.');
                    return;
                }
                totalScore += parseInt(score);
            }
            var gritScore = totalScore / questions.length;
            var percentile = getPercentile(gritScore);
            showModal('와우! 당신의 그릿 점수는 ' + gritScore + '입니다. 이는 상위 ' + percentile + '%에 해당합니다. 계속해서 좋은 작업을 유지하세요!', true);
            return {gritScore: gritScore, percentile: percentile};
        }

        function getPercentile(gritScore) {
            var percentiles = [
                {score: 2.5, percentile: 10},
                {score: 3.0, percentile: 20},
                {score: 3.3, percentile: 30},
                {score: 3.5, percentile: 40},
                {score: 3.8, percentile: 50},
                {score: 3.9, percentile: 60},
                {score: 4.1, percentile: 70},
                {score: 4.3, percentile: 80},
                {score: 4.5, percentile: 90},
                {score: 4.7, percentile: 95},
                {score: 4.9, percentile: 99}
            ];
            for (var i = percentiles.length - 1; i >= 0; i--) {
                if (gritScore >= percentiles[i].score) {
                    return percentiles[i].percentile;
                }
            }
            return 0;
        }

        function showModal(text, showShareButton) {
            var modal = document.getElementById("myModal");
            var span = document.getElementById("close");
            var shareButton = document.getElementById("share-button");
            document.getElementById("modal-text").innerText = text;
            modal.style.display = "block";
            shareButton.style.display = showShareButton ? "block" : "none";
            span.onclick = function() {
                modal.style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }

        function copyToClipboard() {
            var dummy = document.createElement('input');
            var text = window.location.href + '?gritScore=' + calculateGritScore().gritScore + '&percentile=' + calculateGritScore().percentile;

            document.body.appendChild(dummy);
            dummy.value = text;
            dummy.select();
            document.execCommand('copy');
            document.body.removeChild(dummy);

            alert('링크가 클립보드에 복사되었습니다!');
        }

        window.onload = function() {
            var params = new URLSearchParams(window.location.search);
            var gritScore = params.get('gritScore');
            var percentile = params.get('percentile');
            if (gritScore && percentile) {
                showModal('당신의 그릿 점수는 ' + gritScore + '입니다. 이는 상위 ' + percentile + '%에 해당합니다. <a href="' + window.location.origin + '">나도 검사하기</a>', false);
            }
        }
    </script>
</body>
</html>